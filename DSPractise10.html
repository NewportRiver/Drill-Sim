<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Drill Sgt Academy speech training app with module-based script reading, speaking, and typing modes for practical reinforcement." />
  <meta name="author" content="Designed by Bart — Concept AI Assistant" />
  <meta name="copyright" content="© 2025 Drill Sim / Bart. All Rights Reserved." />
  <title>Drill Sgt Academy</title>

  <!--
    ===================================================
    DRILL SGT ACADEMY TRAINING TOOL – HTML5 App v1.7+
    Author: Bart | Newport River Company | 2025
    Purpose: Support speech/typing practice for Drill Sgt candidates.
    Modes: Practice (speak along), Test (transcribe with feedback), Typing (manual input)
    ===================================================
  -->

<!--
    ========================== DEVELOPER UPDATE LOG ============================
    Update: Added typing practise with completion tracker
    Date: April 14, 2025
    Author: Bart
    Summary: JSON script is now embedded in the page for local use if fetch fails or is unavailable.
  -->


  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background: #f0f2f5;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    header {
      background: #20232a;
      color: white;
      padding: 15px;
      width: 100%;
      text-align: center;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
    }

    .container {
      max-width: 900px;
      margin: 20px;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .drill-sgt-icon {
      width: 120px;
      margin-bottom: 20px;
    }

    .module-buttons button,
    .mode-buttons button {
      margin: 8px;
      padding: 10px 20px;
      font-size: 1rem;
      border-radius: 6px;
      border: none;
      background-color: #004085;
      color: white;
      cursor: pointer;
    }

    .module-buttons button:hover,
    .mode-buttons button:hover {
      background-color: #005cbf;
    }

    .script-text {
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background-color: #f9f9f9;
      height: 250px;
      overflow-y: auto;
      text-align: left;
      font-size: 1.1em;
      line-height: 1.6;
    }

    .script-text span {
      opacity: 0.4;
      transition: all 0.2s ease;
    }

    .script-text span.correct {
      opacity: 1;
      color: green;
      font-weight: bold;
    }

    .typing-mode {
      margin-top: 20px;
      display: none;
    }

    .typing-mode input {
      width: 90%;
      padding: 14px;
      font-size: 1.1em;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
    }

 /* Progress bar shown below the script display */
.progress-bar {
  margin-top: 20px;
  width: 100%;
  max-width: 600px;
  display: flex;
  justify-content: space-between;
  height: 20px;
}

.progress-segment {
  flex: 1;
  margin: 0 1px;
  background-color: #ddd;
  border-radius: 4px;
  transition: background-color 0.3s;
}

.progress-segment.filled {
  background-color: green;
}

/* Mobile tweaks only */
@media screen and (max-width: 600px) {
  .script-text {
    font-size: 1em;
    height: 200px;
  }

  .typing-mode input {
    width: 95%;
  }
}

  </style>
</head>
<body>
  <header>
    <h1>Drill Sgt Academy</h1>
  </header>

  <div class="container">
    <img src="drillicon.png" alt="Drill Sgt" class="drill-sgt-icon" id="drillIcon" />

    <div class="module-buttons">
      <button onclick="loadModule(1)">Module 1</button>
    </div>

    <div class="mode-buttons">
      <button onclick="startPracticeMode()">Practice Mode</button>
      <button onclick="startTestingMode()">Testing Mode</button>
      <button onclick="startTypingMode()">Typing Mode</button>
    </div>

    <div class="script-text" id="scriptText"></div>
    <div class="progress-bar" id="progressBar"></div>

    <div class="typing-mode" id="typingMode">
      <input type="text" id="typingInput" placeholder="Type the script here..." oninput="handleTyping()" />
    </div>
  </div>

  <!-- Embedded JSON fallback for local/offline testing -->
  <script>
    const embeddedScripts = {
      1: {
        module: "1",
        title: "Position of Attention",
        script_steps: [
          { step_number: 1, text: "The next position, which I will name, explain, have demonstrated, and which you will conduct practical work on, is the position of attention." },
          { step_number: 2, text: "The position of attention is the key position for all stationary, facing, and marching movements." },
          { step_number: 3, text: "The commands for this position are FALL IN and ATTENTION." },
          { step_number: 4, text: "FALL IN is a combined command. ATTENTION is a two-part command when preceded by a preparatory command, such as Squad, Platoon, or Demonstrator." },
          { step_number: 5, text: "I will use Demonstrator as the preparatory command and ATTENTION is the command of execution." },
          { step_number: 6, text: "When given, these commands are as follows: FALL IN. Demonstrator, ATTENTION." },
          { step_number: 7, text: "Demonstrator, POST. I will use the talk-through method of instruction." },
          { step_number: 8, text: "On the command FALL IN or on the command of execution ATTENTION of Demonstrator, ATTENTION, bring the heels together sharply on line, with the toes pointing out equally, forming a 45-degree angle." },
          { step_number: 9, text: "Rest the weight of the body evenly on the heels and balls of both feet." },
          { step_number: 10, text: "Keep the legs straight without locking the knees." },
          { step_number: 11, text: "Hold the body erect with the hips level, chest lifted and arched, and the shoulders square." },
          { step_number: 12, text: "Keep the head erect and face straight to the front with the chin drawn in so that the alignment of the head and neck is vertical." },
          { step_number: 13, text: "Let the arms hang straight without stiffness." },
          { step_number: 14, text: "Curl the fingers so that the tips of the thumbs are alongside and touching the first joint of the forefingers." },
          { step_number: 15, text: "Keep the thumbs straight along the seams of the trouser leg with the first joint of the fingers touching the trousers." },
          { step_number: 16, text: "Remain silent and do not move unless otherwise directed. RELAX." },
          { step_number: 17, text: "At normal cadence, this position would look as follows: FALL IN. RELAX. Demonstrator, ATTENTION. RELAX." },
          { step_number: 18, text: "What are your questions pertaining to this position when executed at normal cadence or using the talk-through method of instruction?" },
          { step_number: 19, text: "Demonstrator, ATTENTION. You will now become my assistant instructor. FALL OUT." }
        ]
      }
    };
  </script>

  <script>
   // Holds the currently active script content as an array of words
let currentScript = [];

// Tracks current mode: 'practice', 'test', or 'typing'
let currentMode = 'practice';

/**
 * Load a module by number, e.g., 1 = Module 1
 * Tries to load from external JSON, falls back to embeddedScripts if offline
 */
async function loadModule(module) {
  const icon = document.getElementById('drillIcon');
  icon.src = `drill-sgt-module${module}.png`; // Update drill icon per module

  // Reset typing input and hide it (for speech mode)
  document.getElementById('typingInput').value = '';
  document.getElementById('typingMode').style.display = 'none';

  try {
    // Try to load module script from external file
    const res = await fetch(`/script/module${module}_script.json`);
    const data = await res.json();
    currentScript = data.script_steps.map(step => step.text).join(' ').split(/\s+/);
  } catch (err) {
    // Use embedded backup if fetch fails
    const fallback = embeddedScripts[module];
    currentScript = fallback.script_steps.map(step => step.text).join(' ').split(/\s+/);
  }

  displayScript(); // Show the script words on screen
}

/**
 * Display the script as a sequence of <span> words, ready to be matched
 */
function displayScript() {
  const container = document.getElementById('scriptText');
  container.innerHTML = '';

  // Create a span for each word
  currentScript.forEach(word => {
    const span = document.createElement('span');
    span.textContent = word + ' ';
    container.appendChild(span);
  });

  renderProgressBar();      // Draw empty 19-block progress bar
  updateProgressBar();      // Ensure initial state is reset
}

/**
 * Render 19 equal progress segments (each = 5% of script)
 */
function renderProgressBar() {
  const bar = document.getElementById('progressBar');
  bar.innerHTML = ''; // Clear previous segments

  for (let i = 0; i < 19; i++) {
    const segment = document.createElement('div');
    segment.className = 'progress-segment';
    bar.appendChild(segment);
  }
}

/**
 * Update progress based on how many words are marked as 'correct'
 */
function updateProgressBar() {
  const spans = document.querySelectorAll('#scriptText span');
  const matchedCount = Array.from(spans).filter(span => span.classList.contains('correct')).length;
  const totalWords = spans.length;
  const percentComplete = (matchedCount / totalWords) * 100;

  // Fill segments based on 5% intervals (total of 19 segments)
  const segmentsToFill = Math.floor(percentComplete / 5);
  const segments = document.querySelectorAll('.progress-segment');

  segments.forEach((segment, i) => {
    if (i < segmentsToFill) {
      segment.classList.add('filled');
    } else {
      segment.classList.remove('filled');
    }
  });
}

/**
 * Typing Mode Logic: Highlight each correct typed word
 */
function handleTyping() {
  const typedText = document.getElementById('typingInput').value.trim().toLowerCase();
  const typedWords = typedText.split(/\s+/);
  const spans = document.querySelectorAll('#scriptText span');

  // Compare typed words to original script
  spans.forEach((span, index) => {
    const expectedWord = currentScript[index]?.toLowerCase();
    if (typedWords[index] === expectedWord) {
      span.classList.add('correct');
    }
  });

  updateProgressBar(); // Update visual tracker
}

/**
 * Start Practice Mode (speech-based highlighting)
 */
function startPracticeMode() {
  currentMode = 'practice';
  document.getElementById('typingMode').style.display = 'none';
  startSpeechRecognition();
}

/**
 * Start Testing Mode (only correct words appear as feedback)
 */
function startTestingMode() {
  currentMode = 'test';
  document.getElementById('typingMode').style.display = 'none';
  startSpeechRecognition();
}

/**
 * Show Typing Mode UI
 */
function startTypingMode() {
  currentMode = 'typing';
  document.getElementById('typingMode').style.display = 'block';
}

/**
 * Speech recognition logic using Web Speech API
 */
function startSpeechRecognition() {
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.continuous = true;           // Keep listening until manually stopped
  recognition.interimResults = true;       // Allow real-time feedback

  recognition.onresult = function(event) {
    // Get the most recent spoken words
    const spokenWords = event.results[event.results.length - 1][0].transcript.toLowerCase().trim().split(/\s+/);
    const spans = document.querySelectorAll('#scriptText span');

    // Match spoken words to original script
    spokenWords.forEach(spoken => {
      currentScript.forEach((scriptWord, i) => {
        if (spoken === scriptWord.toLowerCase() && !spans[i].classList.contains('correct')) {
          spans[i].classList.add('correct');
        }
      });
    });

    updateProgressBar(); // Reflect progress visually
  };

  recognition.start();
}
  </script>
</body>
</html>